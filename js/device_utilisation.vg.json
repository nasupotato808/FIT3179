{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "DEVICES UTILISATION IN MALAYSIA",
    "fontSize": 24,
    "font": "Heltica",
    "anchor": "middle",
    "fontWeight": "bold"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/nasupotato808/FIT3179/refs/heads/main/data/MalaysiaMap.json",
    "format": { "type": "topojson", "feature": "my" }
  },
  "params": [
    {
      "name": "Device_selection",
      "value": "util_nonicu",
      "bind": {
        "input": "select",
        "options": ["util_nonicu", "util_icu", "util_vent"],
        "labels": ["Non-ICU Beds", "ICU Beds", "Ventilators"],
        "name": "Device: "
      }
    }
  ],
  "transform": [
    {
      "lookup": "properties.name",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/nasupotato808/FIT3179/refs/heads/main/data/bedutil_01_table_state_clear.csv",
          "format": { "type": "csv" }
        },
        "key": "state",
        "fields": ["util_nonicu", "util_icu", "util_vent"]
      }
    },
    {
      "calculate": "datum[Device_selection]",
      "as": "selected_utilization"
    }
  ],
  "vconcat": [
    {
      "title": "Full Map",
      "width": 1000,
      "height": 300,
      "projection": { "type": "mercator" },
      "layer": [
        {
          "mark": {
            "type": "geoshape",
            "stroke": "grey",
            "fillOpacity": 0.1,
            "fill": "black"
          },
          "data": {
            "url": "https://raw.githubusercontent.com/nasupotato808/FIT3179/refs/heads/main/data/MalaysiaMap.json",
            "format": { "type": "topojson", "feature": "ne_10m_land" }
          }
        },
        {
          "mark": {
            "type": "geoshape",
            "stroke": "grey",
            "fill": "#bdd7e7"
          },
          "data": {
            "url": "https://raw.githubusercontent.com/nasupotato808/FIT3179/refs/heads/main/data/MalaysiaMap.json",
            "format": { "type": "topojson", "feature": "ne_10m_ocean" }
          }
        },
        {
          "mark": { "type": "geoshape", "stroke": "rebeccapurple" },
          "encoding": {
            "color": {
              "field": "selected_utilization",
              "type": "quantitative",
              "scale": {
                "type": "threshold",
                "domain": [25, 50, 75, 100],
                "range": ["#f2f0f7", "#cbc9e2", "#9e9ac8", "#6a51a3"]
              },
              "legend": { "title": "Utilization (%)" }
            },
            "tooltip": [
              {
                "field": "properties.name",
                "type": "nominal",
                "title": "State"
              },
              {
                "field": "selected_utilization",
                "type": "quantitative",
                "title": "Utilization",
                "format": ".2f"
              }
            ]
          }
        }
      ]
    },
    {
      "hconcat": [
        {
          "title": "Zoomed View: W.P. Kuala Lumpur and W.P. Putrajaya",
          "width": 500,
          "height": 300,
          "projection": {
            "type": "mercator",
            "center": [100, 4],
            "scale": 10000
          },
          "layer": [
            {
              "mark": {
                "type": "geoshape",
                "stroke": "grey",
                "fill": "#bdd7e7"
              },
              "data": {
                "url": "https://raw.githubusercontent.com/nasupotato808/FIT3179/refs/heads/main/data/MalaysiaMap.json",
                "format": { "type": "topojson", "feature": "ne_10m_ocean" }
              }
            },
            {
              "mark": { "type": "geoshape", "stroke": "rebeccapurple" },
              "encoding": {
                "color": {
                  "field": "selected_utilization",
                  "type": "quantitative",
                  "scale": {
                    "type": "threshold",
                    "domain": [25, 50, 75, 100],
                    "range": ["#f2f0f7", "#cbc9e2", "#9e9ac8", "#6a51a3"]
                  },
                  "legend": null
                },
                "tooltip": [
                  {
                    "field": "properties.name",
                    "type": "nominal",
                    "title": "State"
                  },
                  {
                    "field": "selected_utilization",
                    "type": "quantitative",
                    "title": "Utilization",
                    "format": ".2f"
                  }
                ]
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "left",
                "dx": 5,
                "dy": -5,
                "fontSize": 12,
                "fontWeight": "bold",
                "color": "#024CAA"
              },
              "encoding": {
                "longitude": { "field": "longitude", "type": "quantitative" },
                "latitude": { "field": "latitude", "type": "quantitative" },
                "text": { "field": "name", "type": "nominal" }
              },
              "data": {
                "values": [
                  {
                    "name": "W.P. Kuala Lumpur",
                    "latitude": 3.1412,
                    "longitude": 101.68653
                  },
                  {
                    "name": "W.P. Putrajaya",
                    "latitude": 2.9264,
                    "longitude": 101.6964
                  }
                ]
              }
            },
            {
              "mark": {
                "type": "rule",
                "color": "black",
                "strokeWidth": 0.5
              },
              "encoding": {
                "latitude": { "field": "latitude", "type": "quantitative" },
                "longitude": { "field": "longitude", "type": "quantitative" },
                "latitude2": { "field": "latitude2", "type": "quantitative" },
                "longitude2": { "field": "longitude2", "type": "quantitative" }
              },
              "data": {
                "values": [
                  {
                    "latitude": 3.1412,
                    "longitude": 101.68653,
                    "latitude2": 3.1412,
                    "longitude2": 101.68653
                  },
                  {
                    "latitude": 2.9264,
                    "longitude": 101.6964,
                    "latitude2": 2.9264,
                    "longitude2": 101.6964
                  }
                ]
              }
            }
          ]
        },
        {
          "title": "Zoomed View: W.P. Labuan",
          "width": 500,
          "height": 300,
          "projection": {
            "type": "mercator",
            "center": [114, 6],
            "scale": 10000
          },
          "layer": [
            {
              "mark": {
                "type": "geoshape",
                "stroke": "grey",
                "fill": "#bdd7e7"
              },
              "data": {
                "url": "https://raw.githubusercontent.com/nasupotato808/FIT3179/refs/heads/main/data/MalaysiaMap.json",
                "format": { "type": "topojson", "feature": "ne_10m_ocean" }
              }
            },
            {
              "mark": { "type": "geoshape", "stroke": "rebeccapurple" },
              "encoding": {
                "color": {
                  "field": "selected_utilization",
                  "type": "quantitative",
                  "scale": {
                    "type": "threshold",
                    "domain": [25, 50, 75, 100],
                    "range": ["#f2f0f7", "#cbc9e2", "#9e9ac8", "#6a51a3"]
                  },
                  "legend": null
                },
                "tooltip": [
                  {
                    "field": "properties.name",
                    "type": "nominal",
                    "title": "State"
                  },
                  {
                    "field": "selected_utilization",
                    "type": "quantitative",
                    "title": "Utilization",
                    "format": ".2f"
                  }
                ]
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "left",
                "dx": 5,
                "dy": -5,
                "fontSize": 12,
                "fontWeight": "bold",
                "color": "#024CAA"
              },
              "encoding": {
                "longitude": { "field": "longitude", "type": "quantitative" },
                "latitude": { "field": "latitude", "type": "quantitative" },
                "text": { "field": "name", "type": "nominal" }
              },
              "data": {
                "values": [
                  {
                    "name": "W.P. Labuan",
                    "latitude": 5.3166,
                    "longitude": 115.2
                  }
                ]
              }
            },
            {
              "mark": {
                "type": "rule",
                "color": "black",
                "strokeWidth": 0.5
              },
              "encoding": {
                "latitude": { "field": "latitude", "type": "quantitative" },
                "longitude": { "field": "longitude", "type": "quantitative" },
                "latitude2": { "field": "latitude2", "type": "quantitative" },
                "longitude2": { "field": "longitude2", "type": "quantitative" }
              },
              "data": {
                "values": [
                  {
                    "latitude": 5.3166,
                    "longitude": 115.2,
                    "latitude2": 5.3166,
                    "longitude2": 115.2
                  }
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}
